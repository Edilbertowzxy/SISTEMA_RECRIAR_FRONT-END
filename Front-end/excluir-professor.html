<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Excluir Professor - Sistema Recriar</title>
    <link rel="stylesheet" href="style.css">
    <script src="common.js" defer></script>
</head>
<body>
    <div id="menu-container"></div>

    <main>
        <div class="container">
            <h2>Excluir Professor</h2>
            <div id="feedback-message" class="feedback-message" style="display: none;"></div>

            <p>Tem certeza que deseja excluir o professor abaixo?</p>

            <div id="dadosProfessor" class="card" style="margin: 1rem 0; padding: 1rem;"></div>

            <div class="form-actions">
                <button type="button" class="btn-danger" onclick="confirmarExclusao()">Confirmar Exclusão</button>
                <button type="button" class="btn-secundario" onclick="cancelarExclusao()">Cancelar</button>
            </div>
        </div>
    </main>

    <script src="menu.js" defer></script>
    <script>
        let professorIdToDelete = null;

        document.addEventListener("DOMContentLoaded", () => {
            if (!Auth.requireAuth()) return;

            const urlParams = new URLSearchParams(window.location.search);
            professorIdToDelete = urlParams.get("id");

            if (professorIdToDelete) {
                carregarDadosProfessorParaExclusao(professorIdToDelete);
            } else {
                console.error("ID do professor não fornecido na URL.");
                UI.showMessage("ID do professor não fornecido. Redirecionando para a página de professores.", "error");
                setTimeout(() => { window.location.href = "professores.html"; }, 2000);
            }
        });

        async function carregarDadosProfessorParaExclusao(id) {
            try {
                const professor = await API.get(`/professor/${id}`);
                if (professor) {
                    document.getElementById("dadosProfessor").innerHTML = `
                        <p><strong>ID:</strong> ${professor.id}</p>
                        <p><strong>Nome:</strong> ${professor.nome}</p>
                        <p><strong>Email:</strong> ${professor.email}</p>
                        <p><strong>Documento:</strong> ${professor.documento}</p>
                    `;
                } else {
                    UI.showMessage("Professor não encontrado.", "error");
                    setTimeout(() => { window.location.href = "professores.html"; }, 2000);
                }
            } catch (error) {
                console.error("Erro ao carregar dados do professor para exclusão:", error);
                UI.showMessage("Não foi possível carregar os dados do professor.", "error");
                setTimeout(() => { window.location.href = "professores.html"; }, 2000);
            }
        }

        async function confirmarExclusao() {
            if (!professorIdToDelete) {
                UI.showMessage("ID do professor não encontrado para exclusão.", "error");
                return;
            }

            try {
                await API.delete(`/professor/${professorIdToDelete}`);
                UI.showMessage("Professor excluído com sucesso!", "success");
                setTimeout(() => { window.location.href = "professores.html"; }, 2000);
            } catch (error) {
                console.error("Erro ao excluir professor:", error);
                UI.showMessage(error.message || "Erro ao excluir professor.", "error");
            }
        }

        function cancelarExclusao() {
            window.location.href = "professores.html";
        }
    </script>
</body>
</html>
